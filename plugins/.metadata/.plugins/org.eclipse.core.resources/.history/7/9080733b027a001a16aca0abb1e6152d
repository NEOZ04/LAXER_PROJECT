<?php 

namespace laxer\proshop;

use pocketmine\Player;
use pocketmine\utils\Config;
use laxer\Core;
use laxer\ui\CoreUI;

class ProShop {
    
    private $category = null;
    private $item = null;
    
    private function getConfig(){
        return new Config(Core::getInstance()->getDataFolder().'shop/ProShop.json', Config::JSON);
    }
    
    private function getCategories(){
        $data = $this->getConfig()->getAll();
        $categories = [];
        foreach ($data as $c => $v) $categories[] = $c; 
        return $categories;
    }
    
    private function getItems(string $category){
        return $this->getConfig()->get($category);
    }
    
    public function getMainForm(Player $p){
        $ui = CoreUI::Simple(function(Player $p, $data){
            if ($data === null) return false;
            $this->category = $this->getCategories()[$data];
            $this->getItemsForm($p);
        });
        $ui->setTitle(CoreUI::fTitle('PRO SHOP'));
        $btns = $this->getCategories();
        foreach ($btns as $text){
            $ui->addButton(CoreUI::fButton($text));
        }
        $ui->sendToPlayer($p);
    }
    
    public function getItemsForm(Player $p){
        $ui = CoreUI::Simple(function(Player $p, $data){
            if ($data === null) return false;
            $this->item = $this->getItems($this->category)[$data];
        });
        $ui->setTitle(CoreUI::fTitle('PRO SHOP'));
        $btns = $this->getItems($this->category);
        foreach ($btns as $text){
            $ui->addButton(CoreUI::fButton($text));
        }
        $ui->sendToPlayer($p);
    }
    
    public function getConfirmForm(Player $p){
        $ui = CoreUI::Custom(function (Player $p, $data){
            if ($data === null) return false;
        });
        $ui->setTitle(CoreUI::fTitle('PRO SHOP'));
        $ui->addSlider('', 0,0);
        $ui->addLabel('');
        $ui->sendToPlayer($p);
    }
    
}