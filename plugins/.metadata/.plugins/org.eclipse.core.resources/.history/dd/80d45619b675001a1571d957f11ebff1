<?php 

namespace laxer\player;

use pocketmine\event\Listener;
use pocketmine\event\player\PlayerJoinEvent;
use laxer\Core;
use pocketmine\event\player\PlayerQuitEvent;

class PlayerListener implements Listener {
    
    public function onJoin(PlayerJoinEvent $e){
        $p = $e->getPlayer();
        $pd = new PlayerData($p->getName());
        $pd->addAttribute('time', 0);
        $task = Core::getInstance()->getScheduler()->scheduleRepeatingTask(new PlayerTimeTask($pd), 16);
        Core::$_SESSIONS['player_time'][$p->getName()] = $task; 
    }
    
    public function onQuit(PlayerQuitEvent $e){
        $p = $e->getPlayer();
        $task = Core::$_SESSIONS['player_time'][$p->getName()];
        Core::getInstance()->getScheduler()->cancelTask($task->getTaskId());
        
    }
    
}